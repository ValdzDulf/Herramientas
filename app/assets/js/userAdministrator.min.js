"use strict";function updateStatus(e,t){let s,n,a,o=$.ajax({method:"POST",url:"UserAdministrator/updateStatus",data:{id:e,jobCode:t},dataType:"JSON"});o.done(function(e){userTableInstance.ajax.reload(),s=e.message.title,n=e.message.description,a=e.message.type}),o.fail(function(e){if(!e.hasOwnProperty("responseJSON"))return s="Request Execution",n="An error occurred while executing the request",a="danger",void import("./helpers.min.js").then(e=>e.buildToast(s,n,a));if(!e.responseJSON.data)return s=e.responseJSON.title,n=e.responseJSON.description,a=e.responseJSON.type,void import("./helpers.min.js").then(e=>e.buildToast(s,n,a));let t="";$.each(e.responseJSON.data.validation,function(e,s){t+=null!==s.message?`${s.message} <br>`:""}),s=e.responseJSON.message.title,n=t,a=e.responseJSON.message.type}),o.always(function(){import("./helpers.min.js").then(e=>e.buildToast(s,n,a))})}function updateProfile(){let e,t,s,n=$("#form__update--user-profile"),a=$("#button__submit-form--update-user-profile"),o={start:"Update",processing:'<i class="me-2 fa-solid fa-spinner fa-spin-pulse"></i>Procesando'},r=$.ajax({method:"POST",url:"UserAdministrator/updateProfile",data:n.serializeArray(),dataType:"JSON",beforeSend:function(){a.html(o.processing).prop("disabled",!0)}});r.done(function(n){userTableInstance.ajax.reload(),e=n.message.title,t=n.message.description,s=n.message.type}),r.fail(function(n){if(!n.hasOwnProperty("responseJSON"))return e="Request Execution",t="An error occurred while executing the request",void(s="danger");if(!n.responseJSON.data)return e=n.responseJSON.title,t=n.responseJSON.description,void(s=n.responseJSON.type);let a="";$.each(n.responseJSON.data.validation,function(e,t){a+=null!==t.message?`${t.message} <br>`:""}),e=n.responseJSON.message.title,t=a,s=n.responseJSON.message.type}),r.always(function(){a.html(o.start).prop("disabled",!1),modalUpdateProfile.hide(),import("./helpers.min.js").then(n=>n.buildToast(e,t,s))})}function unlockUser(e,t,s){let n=null,a=null,o=null,r=$.ajax({url:"UserAdministrator/unlockUser",method:"POST",data:{jobCode:e,lastSuccessAccessDate:t,type:s},dataType:"JSON"});r.done(function(e){n=e.message.title,a=e.message.description,o=e.message.type}),r.fail(function(e){if(!e.hasOwnProperty("responseJSON"))return n="Request Execution",a="An error occurred while executing the request",void(o="danger");if(!e.responseJSON.data)return n=e.responseJSON.title,a=e.responseJSON.description,void(o=e.responseJSON.type);let t="";$.each(e.responseJSON.data.validation,function(e,s){t+=null!==s.message?`${s.message} <br>`:""}),n=e.responseJSON.message.title,a=t,o=e.responseJSON.message.type}),r.always(function(){userTableInstance.ajax.reload(),import("./helpers.min.js").then(e=>e.buildToast(n,a,o))})}const userTable=$("#table__data--user");$.fn.dataTable.ext.errMode="throw";const userTableInstance=userTable.DataTable({ordering:!1,ajax:{url:"UserAdministrator/getUsers",type:"GET"},dom:"Bfrtip",buttons:[{extend:"pageLength",text:'<i class="fa-solid fa-ellipsis-vertical"></i>',titleAttr:"Rows per Page",className:"btn-dark"},{text:'<i class="fa-solid fa-arrows-rotate"></i>',titleAttr:"Sync",action:function(e,t){t.ajax.reload(null,!1)},className:"btn-dark"},{text:'<i class="me-2 fa-solid fa-file-csv"></i>',titleAttr:"Export CSV",extend:"csv",charset:"UTF-8",bom:!0,className:"btn-dark"}],orderClasses:!1,columns:[{data:"id"},{data:"descriptiveName"},{data:"jobCode"},{data:"email"},{data:"phoneExtension"},{data:"isActive"},{data:"actions"}],columnDefs:[{targets:[0,1,2,4,5,6],className:"text-center"},{targets:5,data:null,render:function(e,t,s){return`\n                    <span class="badge bg-${"1"===s.isActive?"success":"dark"}">\n                        ${"1"===s.isActive?"Active":"Inactive"}\n                    </span>\n                `}},{targets:6,data:null,render:function(e,t,s){return`\n                    <button type="button" class="mx-1 btn btn-sm btn-link badge button__update--status"\n                            title="${"1"===s.isActive?"Disabled":"Enabled"}">\n                        <i class="${"1"===s.isActive?"text-success":"text-dark"} fa-solid fa-toggle-${"1"===s.isActive?"on":"off"} fa-lg"></i>\n                    </button>\n                    \n                    ${"1"===s.isActive?`\n                        <button type="button" class="mx-1 btn btn-sm btn-link badge button__update--profile"\n                                title="Update Profile">\n                            <i class="fa-solid fa-user-pen text-primary"></i>\n                        </button>\n                                        \n                        ${s.wrongAttempts>=10?'<button type="button" class="mx-1 btn btn-sm btn-link badge\n                                     button__unlock--wrong-attempts" title="Unlock Wrong Attempts">\n                                <i class="fa-solid fa-unlock text-warning"></i>\n                            </button>':""}\n                    \n                        ${s.inactiveDays>=15?'<button type="button" class="mx-1 btn btn-sm btn-link badge\n                                     button__unlock--inactive-days" title="Unlock Inactive Days">\n                                <i class="fa-regular fa-calendar-minus text-danger"></i>\n                            </button>':""}`:""}\n                `}}],language:{url:"/herramientas/config/datatables-language.json"},responsive:!0});userTable.on("page.dt",function(){$("html,body").animate({scrollTop:userTable.closest("body").offset().top},100)}),userTableInstance.on("click",".button__update--status",function(){let e=userTableInstance.row($(this).parents()).data();updateStatus(e.id,e.jobCode)});const modalUpdateProfile=new bootstrap.Modal(document.getElementById("modal__update--user-profile"),{});userTableInstance.on("click",".button__update--profile",function(){let e,t,s,n=$("#select__user--profile-id"),a=userTableInstance.row($(this).parents()).data(),o=$.ajax({method:"GET",url:"SelectorBuilder/getActiveProfiles",dataType:"JSON",beforeSend:function(){n.removeClass("is-invalid is-valid"),n.next().remove(),n.find("option").remove()}});o.done(function(e){console.log(e),import("./helpers.min.js").then(e=>e.validateForm(0)),e.data.forEach(function(e){n.append($("<option>",{text:e.text,value:e.value,"data-extra":e.extra}))}),$("#input__user--job-code").val(a.jobCode),$(`#select__user--profile-id option[value=${a.profileId}]`).attr("selected","selected"),modalUpdateProfile.show()}),o.fail(function(n){if(console.log(n),!n.hasOwnProperty("responseJSON"))return e="Request Execution",t="An error occurred while executing the request",s="danger",void import("./helpers.min.js").then(n=>n.buildToast(e,t,s));n.responseJSON.data||(e=n.responseJSON.title,t=n.responseJSON.description,s=n.responseJSON.type,import("./helpers.min.js").then(n=>n.buildToast(e,t,s)))})}),$("#button__submit--user-profile").on("click",function(){updateProfile()}),userTableInstance.on("click",".button__unlock--wrong-attempts",function(){let e=userTableInstance.row($(this).parents()).data();unlockUser(e.jobCode,e.lastSuccessAccessDate,"wrongAttempt")}),userTableInstance.on("click",".button__unlock--inactive-days",function(){let e=userTableInstance.row($(this).parents()).data();unlockUser(e.jobCode,e.lastSuccessAccessDate,"inactiveDays")});